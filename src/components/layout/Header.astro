---
/* src/components/layout/Header.astro */
import "../../styles/global.css";
import Search from "@astrojs/starlight/components/Search.astro";

const navLinks = [
  { name: "Home", href: "/" },
  {
    name: "CIC Guide",
    href: "/cic-guide",
    dropdown: [
      { name: "Western Australia", href: "/wa-guide", active: true },
      { name: "Victoria", href: "#", active: false },
      { name: "New South Wales", href: "#", active: false },
      { name: "Queensland", href: "#", active: false },
      { name: "South Australia", href: "#", active: false },
      { name: "Tasmania", href: "#", active: false },
      { name: "Northern Territory", href: "#", active: false },
      { name: "ACT", href: "#", active: false },
    ],
  },
  { name: "Support Services", href: "/support-services" },
  { name: "Acknowledgements", href: "/acknowledgements" },
];
---

<nav
  id="custom-nav"
  class="fixed top-0 left-0 right-0 z-[100] w-full border-b border-transparent bg-white/90 backdrop-blur-md transition-all duration-300"
>
  <div class="flex h-16 w-full items-center justify-between px-6">
    <a
      href="/"
      class="group flex items-center gap-2 text-black no-underline hover:text-black"
    >
      <div class="font-extrabold text-xl flex items-center">
        <img src="/book.png" alt="Book Logo" class="mr-2 h-8 w-auto" />
        CIC Handbook
      </div>
    </a>

    <div class="hidden md:flex gap-8 items-center h-full">
      {
        navLinks.map((link) =>
          link.dropdown ? (
            <div class="group relative flex h-full items-center">
              <button class="flex h-full cursor-pointer items-center gap-1 bg-transparent p-0 text-[0.95rem] font-medium text-gray-600 transition-colors group-hover:text-[#78081C] focus:outline-none">
                {link.name}
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="transition-transform group-hover:rotate-180"
                >
                  <path d="m6 9 6 6 6-6" />
                </svg>
              </button>
              <div class="absolute left-1/2 top-[calc(100%-0.5rem)] hidden w-56 -translate-x-1/2 pt-2 group-hover:block">
                <div class="overflow-hidden rounded-lg border border-gray-100 bg-white py-2 shadow-xl">
                  {link.dropdown.map((subItem) =>
                    subItem.active ? (
                      <a
                        href={subItem.href}
                        class="block px-4 py-2.5 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-50 hover:text-[#78081C]"
                      >
                        {subItem.name}
                      </a>
                    ) : (
                      <div class="flex cursor-default items-center justify-between bg-gray-50/50 px-4 py-2.5 text-sm text-gray-400">
                        <span>{subItem.name}</span>
                        <span class="rounded bg-gray-100 px-1.5 py-0.5 text-[0.65rem] font-bold uppercase tracking-wider text-gray-500">
                          Soon
                        </span>
                      </div>
                    )
                  )}
                </div>
              </div>
            </div>
          ) : (
            <a
              href={link.href}
              class="flex h-full items-center text-[0.95rem] font-medium text-gray-600 no-underline transition-colors hover:text-[#78081C]"
            >
              {link.name}
            </a>
          )
        )
      }
    </div>

    <div class="flex items-center gap-3">
      <div class="relative z-50">
        <Search {...Astro.props} />
      </div>

      <div class="hidden md:flex">
        <a
          href="https://www.google.com.au"
          class="inline-flex h-10 items-center justify-center rounded-full border-2 border-[#78081c] bg-white px-4 py-2 text-sm font-bold text-[#78081c] no-underline transition hover:bg-[#78081c] hover:text-white"
        >
          Quick Exit
        </a>
      </div>

      <button id="mobile-menu-btn" class="md:hidden p-2 text-gray-700">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="28"
          height="28"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <line x1="4" x2="20" y1="12" y2="12"></line><line
            x1="4"
            x2="20"
            y1="6"
            y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line>
        </svg>
      </button>
    </div>
  </div>
</nav>

<div id="mobile-menu" class="fixed inset-0 z-[100] hidden bg-white flex-col">
  <div
    class="flex h-16 items-center justify-between px-6 border-b border-gray-100"
  >
    <span class="font-extrabold text-xl text-gray-900">Menu</span>
    <button id="close-menu-btn" class="p-2 text-gray-500 hover:text-red-600">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="28"
        height="28"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M18 6 6 18"></path><path d="M6 6 18 18"></path>
      </svg>
    </button>
  </div>

  <div class="flex-1 overflow-y-auto px-6 py-2 flex flex-col">
    {
      navLinks.map((link) =>
        link.dropdown ? (
          <details class="group border-b border-gray-100">
            <summary class="flex w-full cursor-pointer items-center justify-between py-4 text-lg font-semibold text-gray-800 list-none hover:text-[#78081C]">
              {link.name}
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="text-gray-400 transition-transform duration-200 group-open:rotate-180"
              >
                <path d="m6 9 6 6 6-6" />
              </svg>
            </summary>
            <div class="flex flex-col pb-4 pl-4">
              {link.dropdown.map((subItem) =>
                subItem.active ? (
                  <a
                    href={subItem.href}
                    class="block py-3 text-base text-gray-600 hover:text-[#78081C] border-l-2 border-gray-100 pl-4 hover:border-[#78081C]"
                  >
                    {subItem.name}
                  </a>
                ) : (
                  <div class="flex items-center justify-between py-3 pl-4 border-l-2 border-gray-100 text-base text-gray-400">
                    {subItem.name}{" "}
                    <span class="text-[0.6rem] bg-gray-100 px-1.5 py-0.5 rounded font-bold uppercase tracking-wider">
                      Soon
                    </span>
                  </div>
                )
              )}
            </div>
          </details>
        ) : (
          <a
            href={link.href}
            class="block py-4 text-lg font-semibold text-gray-800 border-b border-gray-100 hover:text-[#78081C]"
          >
            {link.name}
          </a>
        )
      )
    }
  </div>

  <div class="border-t border-gray-100 bg-gray-50 p-6 space-y-4">
    <a
      href="https://www.google.com.au"
      class="flex w-full items-center justify-center rounded-lg bg-[#78081C] py-3.5 text-center font-bold text-white shadow-sm transition hover:bg-[#5a0615]"
    >
      Quick Exit
    </a>
  </div>
</div>

<style is:global>
  #mobile-menu details {
    background: transparent !important;
    border: none !important;
    border-bottom: 1px solid #f3f4f6 !important;
    box-shadow: none !important;
    border-radius: 0 !important;
    margin: 0 !important;
    padding: 0 !important;
  }
  #mobile-menu summary {
    background: transparent !important;
    padding: 1rem 0 !important;
    border: none !important;
  }
  #mobile-menu summary::after {
    display: none !important;
  }
  #mobile-menu summary::-webkit-details-marker {
    display: none !important;
  }

  .pagefind-ui__modal {
    z-index: 99999 !important;
  }

  @media (max-width: 768px) {
    site-search button {
      background: transparent !important;
      border: none !important;
      padding: 0.5rem !important;
      width: auto !important;
      box-shadow: none !important;
    }
    site-search button::after {
      display: none !important;
    }
    site-search button svg {
      width: 24px !important;
      height: 24px !important;
      color: #374151 !important;
    }
  }

  .pagefind-ui__form::before {
    top: 50% !important;
    transform: translateY(-50%) !important;
    z-index: 10 !important;
  }

  @media (min-width: 769px) {
    .pagefind-ui__search-input {
      padding-left: 1.25rem !important;
      padding-right: 3rem !important;
    }
    .pagefind-ui__form::before {
      left: auto !important;
      right: 1.25rem !important;
    }
  }

  @media (max-width: 768px) {
    .pagefind-ui__search-input {
      padding-left: 3rem !important;
      padding-right: 1.25rem !important;
    }
    .pagefind-ui__form::before {
      left: 1.25rem !important;
      right: auto !important;
    }
  }
</style>

<script>
  const nav = document.getElementById("custom-nav");
  const menuBtn = document.getElementById("mobile-menu-btn");
  const closeBtn = document.getElementById("close-menu-btn");
  const menu = document.getElementById("mobile-menu");

  window.addEventListener("scroll", () => {
    if (window.scrollY > 20) {
      nav?.classList.add("bg-white", "border-gray-200", "shadow-sm");
      nav?.classList.remove("bg-white/90", "border-transparent");
    } else {
      nav?.classList.remove("bg-white", "border-gray-200", "shadow-sm");
      nav?.classList.add("bg-white/90", "border-transparent");
    }
  });

  function toggleMenu() {
    menu?.classList.toggle("hidden");
    menu?.classList.toggle("flex");
    document.body.style.overflow = menu?.classList.contains("hidden")
      ? ""
      : "hidden";
  }

  menuBtn?.addEventListener("click", toggleMenu);
  closeBtn?.addEventListener("click", toggleMenu);
</script>
