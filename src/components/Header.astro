---
/* src/components/Header.astro */
import Search from "@astrojs/starlight/components/Search.astro";

const navLinks = [
  { name: "Home", href: "/" },
  {
    name: "CIC Guide",
    href: "/cic-guide",
    dropdown: [
      { name: "Western Australia", href: "/wa-guide", active: true },
      { name: "Victoria", href: "#", active: false },
      { name: "New South Wales", href: "#", active: false },
      { name: "Queensland", href: "#", active: false },
      { name: "South Australia", href: "#", active: false },
      { name: "Tasmania", href: "#", active: false },
      { name: "Northern Territory", href: "#", active: false },
      { name: "ACT", href: "#", active: false },
    ],
  },
  { name: "Support Services", href: "/support-services" },
];
---

<nav
  id="custom-nav"
  class="sticky top-0 w-full z-50 bg-white/90 backdrop-blur-md border-b border-transparent transition-all duration-300"
>
  <div
    class="max-w-[1400px] mx-auto px-6 h-16 flex justify-between items-center"
  >
    <a
      href="/"
      class="flex items-center gap-2 group no-underline text-black hover:text-black"
    >
      <div class="font-extrabold text-xl flex items-center">
        <img src="/book.png" alt="Book Logo" class="h-8 w-auto mr-2" />
        CIC Handbook
      </div>
    </a>

    <div class="hidden md:flex gap-8 items-center h-full">
      {
        navLinks.map((link) =>
          link.dropdown ? (
            <div class="relative group h-full flex items-center">
              <button class="flex items-center gap-1 text-gray-600 font-medium text-[0.95rem] group-hover:text-[#78081C] transition-colors focus:outline-none cursor-pointer bg-transparent border-none p-0 h-full">
                {link.name}
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="transition-transform group-hover:rotate-180"
                >
                  <path d="m6 9 6 6 6-6" />
                </svg>
              </button>

              <div class="absolute top-[calc(100%-0.5rem)] left-1/2 -translate-x-1/2 pt-2 hidden group-hover:block w-56">
                <div class="bg-white rounded-lg shadow-xl border border-gray-100 overflow-hidden py-2">
                  {link.dropdown.map((subItem) =>
                    subItem.active ? (
                      <a
                        href={subItem.href}
                        class="block px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-50 hover:text-[#78081C] font-medium"
                      >
                        {subItem.name}
                      </a>
                    ) : (
                      <div class="px-4 py-2.5 text-sm text-gray-400 flex justify-between items-center cursor-default bg-gray-50/50">
                        <span>{subItem.name}</span>
                        <span class="text-[0.65rem] uppercase font-bold tracking-wider bg-gray-100 text-gray-500 px-1.5 py-0.5 rounded">
                          Soon
                        </span>
                      </div>
                    )
                  )}
                </div>
              </div>
            </div>
          ) : (
            <a
              href={link.href}
              class="text-gray-600 font-medium text-[0.95rem] hover:text-[#78081C] transition-colors no-underline flex items-center h-full"
            >
              {link.name}
            </a>
          )
        )
      }
    </div>

    <div class="flex items-center gap-3">
      <div class="custom-search-wrapper">
        <Search />
      </div>

      <a href="https://www.google.com.au" class="quick-exit-btn">
        Quick Exit
      </a>
    </div>
  </div>
</nav>

<script>
  const nav = document.getElementById("custom-nav");

  window.addEventListener("scroll", () => {
    if (window.scrollY > 20) {
      nav?.classList.add("bg-white", "border-gray-200", "shadow-sm");
      nav?.classList.remove("bg-white/90", "border-transparent");
    } else {
      nav?.classList.remove("bg-white", "border-gray-200", "shadow-sm");
      nav?.classList.add("bg-white/90", "border-transparent");
    }
  });
</script>

<style>
  a {
    text-decoration: none !important;
  }

  .quick-exit-btn {
    background-color: white;
    border: 2px solid #78081c;
    color: #78081c !important;
    font-weight: 700;
    padding: 0.4rem 1rem;
    border-radius: 9999px;
    font-size: 0.85rem;
    white-space: nowrap;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 40px;
  }

  .quick-exit-btn:hover {
    background-color: #78081c;
    color: white !important;
  }

  .custom-search-wrapper :global(button) {
    background-color: #78081c !important;
    color: white !important;
    border: none !important;
    border-radius: 9999px !important;
    padding: 0.5rem 1.25rem !important;
    font-size: 0.9rem !important;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.2s;
    box-shadow: 0 4px 6px -1px rgba(120, 8, 28, 0.3);
    height: 40px !important;
    min-height: 40px !important;
  }

  .custom-search-wrapper :global(button:hover) {
    background-color: #5a0615 !important;
    transform: translateY(-1px);
    opacity: 1 !important;
  }

  .custom-search-wrapper :global(svg) {
    color: white !important;
  }

  .custom-search-wrapper :global(.pagefind-ui__search-input::placeholder) {
    color: rgba(255, 255, 255, 0.9) !important;
  }

  .custom-search-wrapper :global(kbd) {
    display: none !important;
  }
</style>
